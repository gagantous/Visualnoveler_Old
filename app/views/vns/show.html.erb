 <% title @vn.name %>
<% description (@vn.name + " - " + @vn.summary.first(150)) %>

<% if @vn.image_coverpage.blank? %>
	<% if user_signed_in?  %>
			<% if current_user.admin? || current_user.mod? %>
			<div class="container">
			<%= link_to 'Crop',crop_vn_path,:class =>"btn blue-button text-center",:style =>"text-decoration:none;" %>
			<%= link_to 'Add Screenshots',screenshots_vn_path,:class =>"btn blue-button text-center",:style =>"text-decoration:none" %>
			<% end %>
			</div>
	<% end %>
<% else %>

		<div class="twittercover" style="background-image:url(<%= asset_path "#{@vn.image_coverpage.url}" if @vn.image_coverpage? %>)">
		<% if user_signed_in?  %>
		<% if current_user.admin? || current_user.mod? %>
		<%= link_to 'Crop',crop_vn_path,:class =>"ghost-buttonimg text-center",:style =>"text-decoration:none;" %>
		<%= link_to 'Add Screenshots',screenshots_vn_path,:class =>"ghost-buttonimg text-center",:style =>"text-decoration:none" %>
		<% end %>
		<% end %>
		</div>
	

<% end %>

<section id="vn-item">
<div class="container vn-show-padding">
	<div class="row">
	
		<div class="col-lg-3">
			<div class="panel panel-default">
  			<div class="panel-body panel-vnshow">

 			<%= link_to edit_vn_path(@vn),:class => "btn ghost-buttonimg vn-buttonedit", 'data-no-turbolink' =>"true" do %>
				<i class="fa fa-pencil"></i>
			<% end %>
 			<% if user_signed_in? %>
			<% if current_user.library_entries.exists?(vn_id: @vn.id,favourite: true) %>
 			<%= link_to favourite_vn_path(@vn, type: "unfavourite"), method: :put,:class => "btn ghost-buttonimg vn-button" do %>
				<i class="fa fa-times"></i>
			<% end %>
			<% else %>
			<%= link_to favourite_vn_path(@vn, type: "favourite"),:class => "btn ghost-buttonimg vn-button", method: :put do %>
				<i class="fa fa-heart"></i>
			<% end %>
				<% end %>
			  <% end %> 
			<%= image_tag("#{@vn.image_poster.url}",:alt => "@vn.name", :class=> "vn-poster") %>

			<% if !@vn.trailer_url.blank? %>
			<%= link_to @vn.trailer_url, :class => "vn-youtube fancyframe" do %>
		
				<i class="fa fa-youtube-play fa-3x dd"></i>
			<% end %> <% end %>

			<span class="vn-contentpadding">
				<ul class="list-inline">
					<% @vn.genres.each do |genre| %>
						<li class="vngenre-padding inline-nopadding"><%= link_to genre.name,genre_path(genre),:class =>"vn-genre summary-text" %></li>
					<% end %>
				</ul>
			</span>

			<span class="vn-contentpadding "><% if !@vn.publishers.blank? %><span class="vn-label">Publishers:</span> 
				<% @vn.publishers.each do |publisher| %>
				<%= link_to publisher.name,publisher_path(publisher) %>
				<% end %>
			</span>
			<br> <% end %>
			<span class="vn-contentpadding "><span class="vn-label">Developer:</span> <% if @vn.developer %><%= link_to @vn.developer.name, developer_path(@vn.developer) %> </span>
			<br> <% end %>
			<span class="vn-contentpadding"><span class="vn-label">Release Date:</span> <%= @vn.release_date %> </span>
			<br>
			<span class="vn-contentpadding "><span class="vn-label">Status:</span> <%= @vn.status %> </span>
			<br>
			<% if !@vn.alias.blank? %>
			<span class="vn-contentpadding "><span class="vn-label">Alias:</span> <%= @vn.alias %> </span>
			<br> <% end %>
			<% unless @vn.buy_1.blank? && @vn.buy_2.blank? && @vn.buy_3.blank? && @vn.buy_4.blank? %>
				<span class="vn-contentpadding "><span class="vn-label">Purchase:</span><%= get_purchase_location(@vn.buy_1) %> <%= get_purchase_location(@vn.buy_2) %> 
					<%= get_purchase_location(@vn.buy_3) %> <%= get_purchase_location(@vn.buy_4) %>
				</span>
			<% end %>
		</div>
	</div>
		</div>
		<div class="col-lg-9 col-md-9">
			<% if @vn.name.length > 30 %>
			 	<span class="h3 vn-contentpadding" style="font-size:19px !important;"><%= @vn.name %> </span>
			<% else %>
			 	<span class="h3 vn-contentpadding"><%= @vn.name %> </span>
			 <% end %>
			  
 			<span class="default-text vn-score">Score: <%= @vn.rating_number%> </span>
 			<!-- start of buttons -->
 			<div class="vn-pull-right">
 				
			 <% if user_signed_in? %>

 			<div class="btn-group status-dropdown" role="group">
   			 <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-bars"></i>
      			Status
     		 <span class="caret"></span>
   			 </button>
   			 <ul class="dropdown-menu">
				<% if current_user.library_entries.exists?(vn_id: @vn.id,status: "watch") %> 
			     	<li class="list-group-item-info"> <% else %> <li>
			    <% end %>
		 			<%= link_to "Playing", status_vn_path(@vn, type: "watch"), method: :post %>
		 		</li>

		      <% if current_user.library_entries.exists?(vn_id: @vn.id,status: "wishlist") %> 
			     	<li class="list-group-item-info"> <% else %> <li>
			    <% end %>
		 			<%= link_to "Wishlist", status_vn_path(@vn, type: "wishlist"), method: :post %>
		 		</li>

		        <% if current_user.library_entries.exists?(vn_id: @vn.id,status: "drop") %> 
			     	<li class="list-group-item-info"> <% else %> <li>
			    <% end %>
		 			<%= link_to "Dropped", status_vn_path(@vn, type: "drop"), method: :post %>
		 		</li>

		 		 <% if current_user.library_entries.exists?(vn_id: @vn.id,status: "complete") %> 
			     	<li class="list-group-item-info"> <% else %> <li>
			    <% end %>
		 			<%= link_to "Completed", status_vn_path(@vn, type: "complete"), method: :post %>
		 		</li>
		    </ul>
  			</div>
  			<div class="btn-group" role="group">
  				<button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-star"></i>
  					Rate
  					<span class="caret"></span>
  				</button>
  				<ul class="dropdown-menu">
  						<% for i in (10).downto(1) do %> 
  						<% if current_user.library_entries.exists?(vn_id: @vn.id,rating: i) %>
			     		<li class="list-group-item-info"> <% else %> <li> <% end %>

  						<%= link_to i.to_s + " - " + rating_string(i), rate_vn_path(@vn, rating: i), method: :put %> <li>
  						<% end %>
  				</ul>
  			</div>

 				<% end %>
 				<!--  end of buttons -->
			</div>
	 	<hr>
			
			
			<span class="vn-contentpadding summary-text"><%= @vn.summary %> </span>
			 <div class="vn-thumbnail-img">
			 	<div class="row">
			 		<div class="col-md-3">
			 		<% unless @vn.image_1.blank? %>
			 		<%= link_to @vn.image_1.url, :class => 'fancybox', :rel =>'group' do %>
					 <%= image_tag("#{@vn.image_1.url(:thumb)}",:alt => "#{@vn.name} screenshot 1", :class=> "img-thumbnail") %>
					 <% end %>
			 		</div> <% end %>

			 		<div class="col-md-3">
			 		<% unless @vn.image_2.blank? %>
					 <%= link_to @vn.image_2.url, :class => 'fancybox', :rel =>'group' do %>
					 <%= image_tag("#{@vn.image_2.url(:thumb)}",:alt => "#{@vn.name} screenshot 2", :class=> "img-thumbnail") %>
					 <% end %>
					</div> <% end %>

			 		<div class="col-md-3">
			 		<% unless @vn.image_3.blank? %>
					<%= link_to @vn.image_3.url, :class => 'fancybox', :rel =>'group' do %>
					 <%= image_tag("#{@vn.image_3.url(:thumb)}",:alt => "#{@vn.name} screenshot 3", :class=> " img-thumbnail") %>
					 <% end %>
					</div> <% end %>

			 		<div class="col-md-3">
			 		<% unless @vn.image_4.blank? %>
					 <%= link_to @vn.image_4.url, :class => 'fancybox', :rel =>'group' do %>
					 <%= image_tag("#{@vn.image_4.url(:thumb)}",:alt => "#{@vn.name} screenshot 4", :class=> "img-thumbnail") %>
					 <% end %>
					</div> <% end %>

				</div>
			</div>
		
	</div>
</div>  <!-- end of container -->

</section>

<section id="vn-character">
<div class="container">
	<div class="row">
		<div class="col-md-12">
			<a href=<%= characters_vn_path(@vn) %>><h3>Characters</h3> </a>
		</div>
			<% @showcharacters.each_slice(6) do |charRow| %>

		<div class="row vnchar-rowpadding">
			<% charRow.each do |char| %>
		<div class="col-md-2 col-xs-3 col-sm-3 removecharacterpadding">
				<div class="col-md-6 adjustcharacter">
					<%= link_to char.img_string.url, :class => 'fancybox', :rel =>'character' do %>
						 <%= image_tag("#{char.img_string.url(:thumb)}",:alt => "#{char.name}", :class=> "img-circle img-thumbnail") %>
					<% end %>
				</div>
				<div class="col-md-6 col-sm-9 vn-characterbottompadding">
					<%= link_to char.name, characters_vn_path(@vn,anchor:char.name.delete(' ')), :class => "h5 vnpage-charname" %> <br>
					<span class="character-role"><%= char.role unless char.role == "Not Set" %> </span>
				</div>
			
		</div> 
		<% end %> 
		</div>
			<% end %>
		</div>
	</div>
</section>

<div class="container">
	<div class="row">
		<% unless @franchise.blank? %>
		<div class="col-md-6 col-xs-12">
			<h3> Related </h3>
			<% @franchise.vns.each do |vn| %>
				<% if @vn != vn %>
				 <%= link_to image_tag(vn.image_poster_url,:alt => vn.name, :class=> "related-thumbnail",:style =>"float:left;"), vn_path(vn)	 %>
				<% end %>
			<% end %>
		</div>
		<% end %>
		<div class="col-md-6 col-xs-12">
			<% unless @vn.route_url.blank? %>
				<h3>Walkthrough</h3>
				<%= link_to image_tag("fuwa.png",:alt => @vn.name + " Character Walkthrough",:class =>"img-responsive vn-walkthroughimg",:style =>"float:left;"),@vn.route_url, :rel => "nofollow",:target =>"_blank"  %>
			<% end %>
		</div>
	</div>
</div>

<section id = "review">
<div class="container">
	<div class="row">
		<div class="col-md-9">
			<h3> Reviews</h3>
			<div class="panel panel-default">
 			<div class="panel-body">
 				<ul class="nav nav-tabs" role="tablist">
 					<li role="presentation" class="active"><a href="#recent" aria-controls="recent" role="tab" data-toggle="tab">Recent</a></li>
 					<li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Positive</a></li>
 					<li role="presentation"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">Negative</a></li>
 					<li role="presentation"><a href="#write" aria-controls="settings" role="tab" data-toggle="tab">Write a Review</a></li>
 				</ul>
 			<div class="row"> 
 				<div class="tab-content">
			
			    <div role="tabpanel" class="tab-pane fade in active" id="recent">
			    	  <% unless @recent_reviews.blank? %>
				    	  <%= render :partial => 'review', :collection => @recent_reviews  %>
						  <%= will_paginate @recent_reviews, renderer: BootstrapPagination::Rails %>
					  <% else %>
					  <h4><i class="fa fa-magic fa-2x" style="color:#000080;"></i> No Reviews</h4>
					  <p>Nobody has written a review for <b><%= @vn.name %></b> yet. Come and write a review about <%= @vn.name %> to let the community know of your thoughts!</p>
					  <% end %>
			    </div>
			    <div role="tabpanel" class="tab-pane" id="messages">
			    	  <%= render :partial => 'review', :collection => @positive_reviews  %>
					 <%= will_paginate @positive_reviews, renderer: BootstrapPagination::Rails %>
				</div>

			    <div role="tabpanel" class="tab-pane" id="settings">
			       	 <%= render :partial => 'review', :collection => @negative_reviews  %>
					 <%= will_paginate @negative_reviews, renderer: BootstrapPagination::Rails %>
			    </div>

			    <div role="tabpanel" class="tab-pane" id="write">
			    <% if user_signed_in? %>
			    <h4 style="margin-top:0px; margin-bottom:20px;">Write a review for <%= @vn.name%>
			    	<%= link_to image_path("markdown.png"), :class => 'fancybox', :rel =>'?' do %>
			     <i class="fa fa-question-circle"></i>
			     <% end %>
			 	</h4>
			     <%= simple_form_for ([@vn,@vn.reviews.build]) do |f| %>
			     	<div class="row">
				     	<div class="col-md-2">
				     		<div class="vn-review-userposter">
				     			<%= display_avatar(current_user,"img-responsive") %>
				     		</div>
				     	</div>
				     	<div class="col-md-10">
				     	<%= f.input :details, :as => :text, required: true,input_html: {:rows => 10 ,:style => "resize:vertical;"} %>
				     	</div>
				     	<div class="col-md-10 col-md-offset-2">
				     		<%= f.input :rating,collection: 0..10,input_html:{style:"width:120px;"},:selected => 5,:required => false %>
				     		 <%= f.button :submit ,"Submit Review", class: "btn btn-success pull-right vn-reviewbutton",data:{ disable_with: "Posting.."} %>
				     		 <%= link_to "Write a full Review",new_vn_review_path(@vn),class: "btn blue-button pull-right vn-fullbutton" %>
							<%= f.hidden_field :user_id,value: current_user.id %>
							<%= f.hidden_field :vn_id,value: @vn.id %>
				     	</div>
			     	</div>
			     <% end %>
			    </div>
			    <!-- if not logged in, tell them to login !-->
			    <% else %>
			    	<h4> You have to be logged in to be able to write a review for <%= @vn.name %>.</h4>
			    <% end %>



			  </div>
			</div>
		
		</div></div> <!-- panels !-->
<!-- col 8 !-->
		</div>
		<!-- Related Section !-->
		
		
</div></div>
</section>

<div class="otherss-padding">
<div class="container">
	<div class="row ">
		<div class="col-md-12">
		<% unless @screenshots.blank? %>
			<h3>Screenshots</h3>
			<% @screenshots.each do |ss| %>
				<div class="col-md-3">
					<%= link_to ss.image.url, :class => 'fancybox', :rel =>'ss' do %>
						 <%= image_tag(ss.image.url(:thumb),:alt => @vn.name, :class=> "img-thumbnail") %>
					<% end %>
				</div>
			<% end %>
		<% end %>
	</div>
	</div>
</div>
</div>

